import E from"./CommonDialog-DZsHkcTd.js";import{N as M}from"./NoData-CtW-Uw0P.js";import{g as k}from"./patientServices-BubTQM7s.js";import{g as w}from"./doctorServices-bRzDQQ4N.js";import{u as O,a as U,d as F,g as B}from"./appointmentServices-CADK6ujI.js";import{t as j,i as I,T as P,b as L,c as x}from"./index-CNe94dDA.js";import{_ as C,v as d,x as r,y as n,z as u,J as f,a1 as y,F as g,L as v,D as p,W as h,M as z,G as _,q as c,A as G,f as b,B as D}from"./_plugin-vue_export-helper-b3T1jOJ5.js";import{a as H}from"./data-XbIIhJAV.js";const J={name:"CreateAppointment",mixins:[j],props:{userData:{type:Object,required:!1}},data(){return{patients:[],doctors:[],patientId:"",doctorId:"",appointmentDate:"",appointmentTime:"",status:"Scheduled",reason:"",notes:"",errors:{patientId:"",doctorId:"",appointmentDate:"",appointmentTime:""},touched:{patientId:!1,doctorId:!1,appointmentDate:!1,appointmentTime:!1,status:!1,reason:!1,notes:!1}}},emits:["appointment-added","cancel-form","appointment-updated"],computed:{formValid(){return this.checkValid()},isEditMode(){return!!this.userData},today(){return new Date().toISOString().substring(0,10)},canChangeStatus(){return I()}},created(){this.refreshPeople()},watch:{userData:{immediate:!0,handler(t){t?(this.patientId=t.patientId||"",this.doctorId=t.doctorId||"",this.appointmentDate=t.appointmentDate||"",this.appointmentTime=t.appointmentTime||"",this.status=t.status||"Scheduled",this.reason=t.reason||"",this.notes=t.notes||"",Object.keys(this.errors).forEach(e=>this.errors[e]="")):this.resetForm()}}},methods:{refreshPeople(){this.patients=k(),this.doctors=w()},baseValidation(){const t={patientId:"",doctorId:"",appointmentDate:"",appointmentTime:""};return this.patientId||(t.patientId="Patient required"),this.doctorId||(t.doctorId="Doctor required"),this.appointmentDate?this.appointmentDate<this.today&&(t.appointmentDate="Cannot be in the past"):t.appointmentDate="Date required",this.appointmentTime||(t.appointmentTime="Time required"),t},checkValid(){const t=this.baseValidation();return Object.values(t).every(e=>e==="")},validateAll(){this.errors=this.baseValidation()},validateField(t){const e=this.baseValidation();this.errors[t]=e[t]||""},onInput(t){this.touched[t]=!0,this.validateField(t)},resetForm(){this.patientId="",this.doctorId="",this.appointmentDate="",this.appointmentTime="",this.status="Scheduled",this.reason="",this.notes="",Object.keys(this.errors).forEach(t=>this.errors[t]=""),Object.keys(this.touched).forEach(t=>this.touched[t]=!1)},submitForm(){if(this.touched=Object.fromEntries(Object.keys(this.touched).map(e=>[e,!0])),this.validateAll(),!this.checkValid())return;const t={patientId:this.patientId,doctorId:this.doctorId,appointmentDate:this.appointmentDate,appointmentTime:this.appointmentTime,status:I()?this.status:"Scheduled",reason:this.reason?.trim()||void 0,notes:this.notes.trim()};this.isEditMode&&this.userData?(O(this.userData.id,t),this.toastSuccess("Appointment updated successfully"),this.$emit("appointment-updated"),this.resetForm()):(U(t),this.toastSuccess("Appointment added successfully"),this.resetForm(),this.$emit("appointment-added"))}}},R={class:"grid grid-cols-1 lg:grid-cols-2 gap-8"},W={class:"space-y-1 text-sm"},K=["value"],Q={key:0,class:"text-xs text-red-600"},X={class:"space-y-1 text-sm"},Y=["value"],Z={key:0,class:"text-xs text-red-600"},$={class:"space-y-1 text-sm"},ee=["min"],te={key:0,class:"text-xs text-red-600"},oe={class:"space-y-1 text-sm"},se={key:0,class:"text-xs text-red-600"},ne={class:"space-y-1 text-sm"},ie={key:1,class:"px-3 py-2 rounded border bg-gray-50 text-gray-600"},re={class:"space-y-1 text-sm"},de={class:"space-y-1 text-sm md:col-span-2"},ae={class:"flex justify-end items-center gap-1 mt-2"},le=["disabled"];function pe(t,e,m,a,o,i){return r(),d("div",null,[n("form",{onSubmit:e[19]||(e[19]=_((...s)=>i.submitForm&&i.submitForm(...s),["prevent"]))},[n("div",R,[n("div",W,[e[21]||(e[21]=n("label",{for:"patientId",class:"block text-gray-600 required"},"Patient",-1)),u(n("select",{id:"patientId","onUpdate:modelValue":e[0]||(e[0]=s=>o.patientId=s),onChange:e[1]||(e[1]=s=>i.onInput("patientId")),class:"w-full px-4 py-3 rounded-md border border-gray-300 focus:border-blue-500 focus:ring-blue-500",required:""},[e[20]||(e[20]=n("option",{value:"",disabled:""},"Select patient",-1)),(r(!0),d(g,null,v(o.patients,s=>(r(),d("option",{key:s.id,value:s.id},p(s.patientName),9,K))),128))],544),[[y,o.patientId]]),o.touched.patientId&&o.errors.patientId?(r(),d("p",Q,p(o.errors.patientId),1)):f("",!0)]),n("div",X,[e[23]||(e[23]=n("label",{for:"doctorId",class:"block text-gray-600 required"},"Doctor",-1)),u(n("select",{id:"doctorId","onUpdate:modelValue":e[2]||(e[2]=s=>o.doctorId=s),onChange:e[3]||(e[3]=s=>i.onInput("doctorId")),class:"w-full px-4 py-3 rounded-md border border-gray-300 focus:border-blue-500 focus:ring-blue-500",required:""},[e[22]||(e[22]=n("option",{value:"",disabled:""},"Select doctor",-1)),(r(!0),d(g,null,v(o.doctors,s=>(r(),d("option",{key:s.id,value:s.id},p(s.doctorName)+" — "+p(s.doctorSpecialist),9,Y))),128))],544),[[y,o.doctorId]]),o.touched.doctorId&&o.errors.doctorId?(r(),d("p",Z,p(o.errors.doctorId),1)):f("",!0)]),n("div",$,[e[24]||(e[24]=n("label",{for:"date",class:"block text-gray-600 required"},"Date",-1)),u(n("input",{type:"date",id:"date","onUpdate:modelValue":e[4]||(e[4]=s=>o.appointmentDate=s),onInput:e[5]||(e[5]=s=>i.onInput("appointmentDate")),onBlur:e[6]||(e[6]=s=>i.onInput("appointmentDate")),min:i.today,class:"w-full px-4 py-3 rounded-md border border-gray-300 focus:border-blue-500 focus:ring-blue-500",required:""},null,40,ee),[[h,o.appointmentDate]]),o.touched.appointmentDate&&o.errors.appointmentDate?(r(),d("p",te,p(o.errors.appointmentDate),1)):f("",!0)]),n("div",oe,[e[25]||(e[25]=n("label",{for:"time",class:"block text-gray-600 required"},"Time",-1)),u(n("input",{type:"time",id:"time","onUpdate:modelValue":e[7]||(e[7]=s=>o.appointmentTime=s),onInput:e[8]||(e[8]=s=>i.onInput("appointmentTime")),onBlur:e[9]||(e[9]=s=>i.onInput("appointmentTime")),placeholder:"09:30",class:"w-full px-4 py-3 rounded-md border border-gray-300 focus:border-blue-500 focus:ring-blue-500",required:""},null,544),[[h,o.appointmentTime]]),o.touched.appointmentTime&&o.errors.appointmentTime?(r(),d("p",se,p(o.errors.appointmentTime),1)):f("",!0)]),n("div",ne,[e[27]||(e[27]=n("label",{for:"status",class:"block text-gray-600"},"Status",-1)),i.canChangeStatus?u((r(),d("select",{key:0,id:"status","onUpdate:modelValue":e[10]||(e[10]=s=>o.status=s),onChange:e[11]||(e[11]=s=>i.onInput("status")),class:"w-full px-4 py-3 rounded-md border border-gray-300 focus:border-blue-500 focus:ring-blue-500"},[...e[26]||(e[26]=[n("option",{value:"Scheduled"},"Scheduled",-1),n("option",{value:"Completed"},"Completed",-1),n("option",{value:"Cancelled"},"Cancelled",-1)])],544)),[[y,o.status]]):(r(),d("p",ie,p(o.status),1))]),n("div",re,[e[28]||(e[28]=n("label",{for:"reason",class:"block text-gray-600"},"Reason",-1)),u(n("input",{id:"reason",type:"text","onUpdate:modelValue":e[12]||(e[12]=s=>o.reason=s),onInput:e[13]||(e[13]=s=>i.onInput("reason")),onBlur:e[14]||(e[14]=s=>i.onInput("reason")),placeholder:"e.g., Follow-up, Consultation",class:"w-full px-4 py-3 rounded-md border border-gray-300 focus:border-blue-500 focus:ring-blue-500"},null,544),[[h,o.reason]])]),n("div",de,[e[29]||(e[29]=n("label",{for:"notes",class:"block text-gray-600"},"Notes",-1)),u(n("textarea",{id:"notes","onUpdate:modelValue":e[15]||(e[15]=s=>o.notes=s),onInput:e[16]||(e[16]=s=>i.onInput("notes")),onBlur:e[17]||(e[17]=s=>i.onInput("notes")),class:"w-full px-4 py-3 rounded-md border border-gray-300 focus:border-blue-500 focus:ring-blue-500 input",rows:"3",placeholder:"Additional details"},null,544),[[h,o.notes]])])]),n("div",ae,[n("button",{type:"button",class:"mr-4 px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400",onClick:e[18]||(e[18]=s=>t.$emit("cancel-form"))},"Cancel"),n("button",{type:"submit",disabled:!i.formValid,class:z(["px-4 py-2 rounded-md text-white",i.formValid?"bg-blue-600 hover:bg-blue-700":"bg-blue-300 cursor-not-allowed"])},p(i.isEditMode?"Update":"Submit"),11,le)])],32)])}const ue=C(J,[["render",pe]]),me={name:"Appointment",data(){return{rows:[],headers:H,searchValue:"",isDialogOpen:!1,selected:void 0}},computed:{filteredAppointments(){const t=this.searchValue.trim().toLowerCase();return t?this.rows.filter(e=>[e.patientName,e.doctorName,e.doctorSpecialist,e.appointmentDate,e.appointmentTime,e.status,e.notes].some(m=>(m||"").toLowerCase().includes(t))):this.rows}},mounted(){this.refresh()},components:{NoData:M,CommonDialog:E,CreateAppointment:ue,EditIcon:L,TrashIcon:P},methods:{closeDialog(){this.isDialogOpen=!1,this.selected=void 0,this.refresh()},refresh(){const t=B(),e=new Map(k().map(a=>[a.id,a])),m=new Map(w().map(a=>[a.id,a]));this.rows=t.map(a=>({...a,patientName:e.get(a.patientId)?.patientName||"—",doctorName:m.get(a.doctorId)?.doctorName||"—",doctorSpecialist:m.get(a.doctorId)?.doctorSpecialist||"—"}))},edit(t){this.selected=t,this.isDialogOpen=!0},remove(t){x(t.createdBy)&&confirm("Delete this appointment?")&&(F(t.id),this.selected=void 0,this.refresh())},canModify(t){return x(t)},onUpdated(){this.selected=void 0,this.refresh(),this.closeDialog()}}},ce={class:"flex justify-between items-center flex-wrap"},fe={class:"justify-end flex mb-4 items-end gap-4"},be=["onClick"],he=["onClick"],ye={key:1};function ge(t,e,m,a,o,i){const s=c("EditIcon"),T=c("TrashIcon"),V=c("EasyDataTable"),A=c("NoData"),S=c("CreateAppointment"),N=c("CommonDialog");return r(),d(g,null,[n("div",ce,[e[6]||(e[6]=n("div",null,[n("h1",{class:"text-3xl font-bold"},"Appointments")],-1)),n("div",fe,[n("div",null,[e[5]||(e[5]=n("span",null,"search value: ",-1)),u(n("input",{type:"text",class:"input","onUpdate:modelValue":e[0]||(e[0]=l=>o.searchValue=l)},null,512),[[h,o.searchValue]])]),n("button",{type:"button",class:"inline-flex items-center rounded bg-blue-600 h-fit px-4 py-2 text-white text-sm hover:bg-blue-700 focus:outline-none focus:ring",onClick:e[1]||(e[1]=l=>o.isDialogOpen=!0)}," Add new ")])]),o.rows&&o.rows.length?(r(),G(V,{key:0,headers:o.headers,items:i.filteredAppointments,alternating:"","rows-per-page":5},{"item-actions":D(l=>[i.canModify(l.createdBy)?(r(),d("button",{key:0,class:"action-btn",onClick:q=>i.edit(l),"aria-label":"Edit"},[b(s,{class:"w-4 h-4"})],8,be)):f("",!0),i.canModify(l.createdBy)?(r(),d("button",{key:1,class:"action-btn danger",onClick:q=>i.remove(l),"aria-label":"Delete"},[b(T,{class:"w-4 h-4"})],8,he)):f("",!0)]),_:1},8,["headers","items"])):(r(),d("div",ye,[b(A,{message:"No appointments found",description:"Try adjusting your filters."})])),b(N,{modelValue:o.isDialogOpen,"onUpdate:modelValue":e[4]||(e[4]=l=>o.isDialogOpen=l),title:"Appointment","close-on-esc":!0,"close-on-backdrop":!0},{default:D(()=>[b(S,{"user-data":o.selected,onCancelForm:e[2]||(e[2]=l=>i.closeDialog()),onAppointmentAdded:e[3]||(e[3]=l=>i.closeDialog()),onAppointmentUpdated:i.onUpdated},null,8,["user-data","onAppointmentUpdated"])]),_:1},8,["modelValue"])],64)}const Ve=C(me,[["render",ge],["__scopeId","data-v-1fe4aac3"]]);export{Ve as default};
